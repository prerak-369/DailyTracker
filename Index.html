<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrowthOS - Advanced Habit Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f0f2f5;
            color: #1a1c1e;
        }

        .custom-scrollbar::-webkit-scrollbar { height: 6px; width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        .cell-pending { background-color: #ffffff; border: 1px solid #e2e8f0; }
        .cell-completed { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important; 
            border: none !important; color: white; 
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
        }
        .cell-failed { 
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%) !important; 
            border: none !important; color: white;
            box-shadow: 0 2px 4px rgba(244, 63, 94, 0.2);
        }

        .grid-cell {
            width: 30px; height: 30px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: 800; border-radius: 8px; flex-shrink: 0;
        }

        .grid-cell:not(.locked):hover { transform: scale(1.15); z-index: 30; }
        
        .grid-cell.locked {
            cursor: not-allowed;
            opacity: 0.3;
            background-color: #f8fafc;
            border: 1px dashed #cbd5e1;
        }

        .today-highlight {
            background-color: rgba(79, 70, 229, 0.05);
            border-left: 2px solid #4f46e5;
            border-right: 2px solid #4f46e5;
        }

        .sticky-col {
            position: sticky; left: 0;
            background: white; z-index: 20;
            box-shadow: 4px 0 10px -5px rgba(0,0,0,0.05);
        }

        .heatmap-cell {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            transition: all 0.2s;
        }

        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .celebrate-row { animation: celebrate 0.5s ease-out; }
    </style>
</head>
<body class="p-4 md:p-6 lg:p-10">

    <div class="max-w-[1800px] mx-auto">
        <header class="flex flex-col xl:flex-row xl:items-center justify-between gap-8 mb-8">
            <div class="space-y-1">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 p-2 rounded-xl shadow-lg shadow-indigo-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
                    </div>
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Growth<span class="text-indigo-600">OS</span></h1>
                </div>
                <p id="motivationalMessage" class="text-slate-500 font-medium ml-11 italic text-sm">Today is <span id="currentDateDisplay" class="text-indigo-600 font-bold"></span>.</p>
            </div>
            
            <div class="flex flex-wrap items-center gap-4">
                <select id="monthSelector" onchange="changeMonth()" class="bg-white px-4 py-3 rounded-2xl border border-slate-200 font-bold text-slate-700 shadow-sm focus:ring-2 focus:ring-indigo-500 outline-none cursor-pointer"></select>

                <div class="flex items-center gap-2 bg-white p-2 rounded-2xl shadow-sm border border-slate-200">
                    <input type="text" id="goalInput" placeholder="Add new habit..." class="px-4 py-2 bg-transparent focus:outline-none font-bold text-slate-700 w-32 md:w-48">
                    <button onclick="addGoal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-xl font-bold transition-all active:scale-95 shadow-md">Add</button>
                </div>

                <button onclick="exportData()" class="bg-white hover:bg-slate-50 text-slate-600 p-3 rounded-2xl border border-slate-200 transition-all active:scale-95 shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                </button>
            </div>
        </header>

        <!-- Quote Section -->
        <div class="mb-10 p-6 bg-white rounded-3xl border border-indigo-50 shadow-sm flex flex-col md:flex-row items-center gap-6">
            <div class="w-12 h-12 bg-indigo-100 rounded-2xl flex items-center justify-center text-indigo-600 flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 2.5 1 4.5 5 6m11 0c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 2.5 1 4.5 5 6"></path></svg>
            </div>
            <div>
                <p id="dailyQuote" class="text-slate-700 font-semibold text-lg italic leading-tight">"The secret of getting ahead is getting started."</p>
                <p id="quoteAuthor" class="text-slate-400 text-sm mt-1 font-bold uppercase tracking-widest">â€” Mark Twain</p>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
            <div class="xl:col-span-3 space-y-8">
                <!-- Main Grid Container -->
                <div class="bg-white rounded-[2rem] shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden">
                    <div class="overflow-x-auto custom-scrollbar">
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-slate-50/80 border-b border-slate-100">
                                    <th class="p-6 sticky-col text-left text-[10px] font-black uppercase text-slate-400 tracking-widest min-w-[300px]">Habit</th>
                                    <script>
                                        const now = new Date();
                                        const today = now.getDate();
                                        for(let i=1; i<=31; i++) {
                                            const isToday = i === today;
                                            document.write(`<th class="p-2 text-center text-[10px] font-bold ${isToday ? 'text-indigo-600 bg-indigo-50' : 'text-slate-400'} min-w-[42px]">${i}</th>`);
                                        }
                                    </script>
                                    <th class="p-6 text-center text-[10px] font-black uppercase text-slate-400 tracking-widest">Rate</th>
                                </tr>
                            </thead>
                            <tbody id="gridBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Insights & Weekly Trends Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-sm font-black uppercase tracking-widest text-slate-400">7-Day Momentum</h3>
                            <span class="text-[10px] font-bold px-2 py-1 bg-indigo-50 text-indigo-600 rounded-lg">Pulse</span>
                        </div>
                        <div class="h-40">
                            <canvas id="momentumChart"></canvas>
                        </div>
                    </div>

                    <!-- NEW: Activity Heatmap & Consistency Pulse -->
                    <div class="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm flex flex-col">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-sm font-black uppercase tracking-widest text-slate-400">Activity Heatmap</h3>
                            <div class="flex gap-1">
                                <div class="w-2 h-2 rounded-full bg-slate-100"></div>
                                <div class="w-2 h-2 rounded-full bg-emerald-200"></div>
                                <div class="w-2 h-2 rounded-full bg-emerald-400"></div>
                                <div class="w-2 h-2 rounded-full bg-emerald-600"></div>
                            </div>
                        </div>
                        <div id="heatmapContainer" class="flex flex-wrap gap-2 mb-6">
                            <!-- Populated by JS -->
                        </div>
                        <div class="mt-auto grid grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-4 rounded-2xl">
                                <p class="text-[9px] uppercase font-bold text-slate-400 mb-1 tracking-tighter">Consistency Trend</p>
                                <p id="trendStatus" class="text-sm font-extrabold text-slate-700">Stable</p>
                            </div>
                            <div class="bg-slate-50 p-4 rounded-2xl">
                                <p class="text-[9px] uppercase font-bold text-slate-400 mb-1 tracking-tighter">Projected Finish</p>
                                <p id="projectedRate" class="text-sm font-extrabold text-slate-700">--%</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="bg-slate-900 rounded-[2rem] p-8 text-white shadow-2xl relative overflow-hidden">
                    <h3 class="text-xl font-bold mb-8">Performance</h3>
                    <div class="relative h-56 mb-8"><canvas id="globalChart"></canvas></div>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="p-4 bg-white/5 rounded-2xl border border-white/10 text-center">
                            <p class="text-[10px] uppercase font-black text-indigo-400 mb-1">Max Streak</p>
                            <p id="topStreak" class="text-2xl font-black">0</p>
                        </div>
                        <div class="p-4 bg-white/5 rounded-2xl border border-white/10 text-center">
                            <p class="text-[10px] uppercase font-black text-emerald-400 mb-1">Best Day</p>
                            <p id="bestDay" class="text-2xl font-black">--</p>
                        </div>
                    </div>
                    <div id="dynamicFeedback" class="mb-6 p-4 bg-indigo-500/10 rounded-2xl border border-indigo-500/20 text-xs font-medium text-indigo-300 italic text-center leading-relaxed">
                        Keep moving! Every checkmark is a step closer to your goals.
                    </div>
                    <button onclick="factoryReset()" class="w-full py-3 bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all">Factory Reset</button>
                </div>

                <div class="bg-white rounded-[2rem] p-8 border border-slate-100 shadow-sm">
                    <h4 class="text-xs font-black uppercase tracking-widest text-slate-400 mb-4">Milestones</h4>
                    <div id="milestoneList" class="space-y-3">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let masterData = JSON.parse(localStorage.getItem('habitOS_master')) || {};
        let currentYear = new Date().getFullYear();
        let currentMonthName = new Intl.DateTimeFormat('en-US', { month: 'long' }).format(new Date());
        let globalChart = null;
        let momentumChart = null;

        const quotes = [
            { text: "We are what we repeatedly do. Excellence, then, is not an act, but a habit.", author: "Aristotle" },
            { text: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius" },
            { text: "Successful people are simply those with successful habits.", author: "Brian Tracy" },
            { text: "Motivation is what gets you started. Habit is what keeps you going.", author: "Jim Ryun" },
            { text: "Your net worth to the world is usually determined by what remains after your bad habits are subtracted from your good ones.", author: "Benjamin Franklin" },
            { text: "The first step toward success is taken when you refuse to be a captive of the environment in which you find yourself.", author: "Mark Caine" }
        ];

        function init() {
            document.getElementById('currentDateDisplay').innerText = new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
            setRandomQuote();
            populateMonthSelector();
            ensureMonthExists(currentMonthName);
            renderGrid();
            updateGlobalAnalytics();
            
            document.getElementById('goalInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') addGoal(); });
        }

        function setRandomQuote() {
            const q = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('dailyQuote').innerText = `"${q.text}"`;
            document.getElementById('quoteAuthor').innerText = `â€” ${q.author}`;
        }

        function populateMonthSelector() {
            const selector = document.getElementById('monthSelector');
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            selector.innerHTML = months.map(m => `<option value="${m}" ${m === currentMonthName ? 'selected' : ''}>${m} ${currentYear}</option>`).join('');
        }

        function ensureMonthExists(month) {
            if (!masterData[month]) {
                masterData[month] = [
                    { id: 1, name: "Morning Routine", checks: Array(31).fill(0) },
                    { id: 2, name: "Deep Work", checks: Array(31).fill(0) },
                    { id: 3, name: "Fitness", checks: Array(31).fill(0) }
                ];
            }
        }

        function changeMonth() {
            currentMonthName = document.getElementById('monthSelector').value;
            ensureMonthExists(currentMonthName);
            renderGrid();
            updateGlobalAnalytics();
        }

        function addGoal() {
            const input = document.getElementById('goalInput');
            const val = input.value.trim();
            if (val) {
                masterData[currentMonthName].push({ id: Date.now(), name: val, checks: Array(31).fill(0) });
                input.value = '';
                saveData(); renderGrid(); updateGlobalAnalytics();
            }
        }

        function toggleCell(goalId, dayIndex) {
            const now = new Date();
            const todayNum = now.getDate();
            const actualMonth = new Intl.DateTimeFormat('en-US', { month: 'long' }).format(now);
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            
            const isFutureMonth = months.indexOf(currentMonthName) > months.indexOf(actualMonth);
            const isFutureDay = (currentMonthName === actualMonth && (dayIndex + 1) > todayNum);

            if (isFutureMonth || isFutureDay) return;

            const goal = masterData[currentMonthName].find(g => g.id === goalId);
            if (goal) {
                goal.checks[dayIndex] = (goal.checks[dayIndex] + 1) % 3;
                if (goal.checks[dayIndex] === 1) checkDailyCompletion(dayIndex);
                saveData(); renderGrid(); updateGlobalAnalytics();
            }
        }

        function checkDailyCompletion(dayIdx) {
            const goals = masterData[currentMonthName];
            const allDone = goals.every(g => g.checks[dayIdx] === 1);
            if (allDone) {
                document.getElementById('motivationalMessage').innerText = "Incredible! You've crushed every single goal for today! ðŸŽ‰";
                document.getElementById('motivationalMessage').classList.add('text-emerald-600');
            }
        }

        function renderGrid() {
            const tbody = document.getElementById('gridBody');
            const goals = masterData[currentMonthName];
            const todayNum = new Date().getDate();
            const actualMonth = new Intl.DateTimeFormat('en-US', { month: 'long' }).format(new Date());
            tbody.innerHTML = '';

            goals.forEach(goal => {
                const row = document.createElement('tr');
                row.className = 'group border-b border-slate-50 last:border-0 hover:bg-slate-50/50';
                const done = goal.checks.filter(c => c === 1).length;
                const score = Math.round((done / 31) * 100);

                let rowHtml = `<td class="p-6 sticky-col"><div class="flex items-center gap-4"><div class="flex-1 min-w-0"><p class="font-bold text-slate-800 truncate text-sm">${goal.name}</p></div><button onclick="deleteGoal(${goal.id})" class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-rose-500 p-2 transition-all"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg></button></div></td>`;

                goal.checks.forEach((status, idx) => {
                    const isToday = (idx + 1 === todayNum && currentMonthName === actualMonth);
                    const isLocked = (currentMonthName === actualMonth && (idx + 1) > todayNum);
                    
                    let sClass = status === 1 ? 'cell-completed' : (status === 2 ? 'cell-failed' : 'cell-pending');
                    if (isLocked) sClass += ' locked';

                    rowHtml += `<td class="p-1 ${isToday ? 'today-highlight' : ''}"><div class="grid-cell mx-auto ${sClass}" onclick="toggleCell(${goal.id}, ${idx})">${isLocked ? '<svg class="w-2 h-2" fill="currentColor" viewBox="0 0 20 20"><path d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"></path></svg>' : (status === 1 ? 'âœ“' : (status === 2 ? 'âœ•' : ''))}</div></td>`;
                });

                rowHtml += `<td class="p-6 text-center font-black text-xs text-slate-400">${score}%</td>`;
                row.innerHTML = rowHtml;
                tbody.appendChild(row);
            });
        }

        function updateGlobalAnalytics() {
            const goals = masterData[currentMonthName];
            let done = 0, fail = 0, pending = 0;
            let dayScores = Array(31).fill(0);
            
            goals.forEach(g => g.checks.forEach((c, i) => { 
                if(c===1) { done++; dayScores[i]++; }
                else if(c===2) fail++; 
                else pending++; 
            }));
            
            const totalItems = goals.length * 31;
            const successRate = totalItems > 0 ? (done / totalItems) * 100 : 0;
            
            const feedback = document.getElementById('dynamicFeedback');
            if (successRate > 40) feedback.innerText = "Absolute legend! You're dominating this month. Don't slow down!";
            else if (successRate > 20) feedback.innerText = "Strong work! You're more consistent than most. Keep that momentum.";
            else feedback.innerText = "Today is a new opportunity to restart. One checkmark is all it takes.";

            const bestDayVal = Math.max(...dayScores);
            const bestDayIdx = dayScores.indexOf(bestDayVal);
            document.getElementById('bestDay').innerText = bestDayVal > 0 ? (bestDayIdx + 1) : '--';

            // Calculate Max Streak (Consective days with at least one check)
            let maxStreak = 0, currentStreak = 0;
            dayScores.forEach(score => {
                if(score > 0) { currentStreak++; maxStreak = Math.max(maxStreak, currentStreak); }
                else currentStreak = 0;
            });
            document.getElementById('topStreak').innerText = maxStreak;

            // Activity Heatmap
            const heatmap = document.getElementById('heatmapContainer');
            heatmap.innerHTML = dayScores.map(score => {
                let opacity = 'bg-slate-100';
                if(score > 0) {
                    const ratio = score / goals.length;
                    if(ratio > 0.7) opacity = 'bg-emerald-600';
                    else if(ratio > 0.4) opacity = 'bg-emerald-400';
                    else opacity = 'bg-emerald-200';
                }
                return `<div class="heatmap-cell ${opacity}"></div>`;
            }).join('');

            // Projections
            const today = new Date().getDate();
            const projected = Math.round((done / (today * goals.length)) * 100) || 0;
            document.getElementById('projectedRate').innerText = `${projected}%`;
            
            const lastWeekSum = dayScores.slice(Math.max(0, today - 7), today).reduce((a,b)=>a+b, 0);
            const prevWeekSum = dayScores.slice(Math.max(0, today - 14), Math.max(0, today - 7)).reduce((a,b)=>a+b, 0);
            document.getElementById('trendStatus').innerText = lastWeekSum > prevWeekSum ? "Improving â†‘" : (lastWeekSum < prevWeekSum ? "Declining â†“" : "Stable");

            updateMilestones(successRate * 2.5, done); // Scaled for milestone visibility
            renderCharts(done, fail, pending, dayScores);
        }

        function renderCharts(done, fail, pending, dayScores) {
            const ctx = document.getElementById('globalChart').getContext('2d');
            if (globalChart) globalChart.destroy();
            globalChart = new Chart(ctx, {
                type: 'doughnut',
                data: { datasets: [{ data: [done, fail, pending], backgroundColor: ['#10b981', '#f43f5e', '#1e293b'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '85%', plugins: { legend: { display: false } } }
            });

            const today = new Date().getDate();
            const last7 = dayScores.slice(Math.max(0, today - 7), today);
            const labels = last7.map((_, i) => `D${today - (last7.length - 1 - i)}`);

            const mCtx = document.getElementById('momentumChart').getContext('2d');
            if (momentumChart) momentumChart.destroy();
            momentumChart = new Chart(mCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pulse',
                        data: last7,
                        borderColor: '#6366f1',
                        borderWidth: 4,
                        pointRadius: 0,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(99, 102, 241, 0.1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, display: false },
                        x: { grid: { display: false }, ticks: { font: { size: 9, weight: 'bold' }, color: '#94a3b8' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function updateMilestones(rate, total) {
            const milestones = [
                { id: 'm1', text: "Getting Started", condition: total >= 1, icon: "ðŸŒ±" },
                { id: 'm2', text: "Consistency King", condition: rate >= 50, icon: "ðŸ‘‘" },
                { id: 'm3', text: "Century Club", condition: total >= 100, icon: "ðŸ’¯" },
                { id: 'm4', text: "Iron Will", condition: rate >= 80, icon: "âš”ï¸" }
            ];

            const list = document.getElementById('milestoneList');
            list.innerHTML = milestones.map(m => `
                <div class="flex items-center justify-between p-3 rounded-2xl ${m.condition ? 'bg-emerald-50 border border-emerald-100' : 'bg-slate-50 opacity-40'} transition-all">
                    <div class="flex items-center gap-3">
                        <span class="text-xl">${m.icon}</span>
                        <span class="text-xs font-bold ${m.condition ? 'text-emerald-700' : 'text-slate-500'}">${m.text}</span>
                    </div>
                    ${m.condition ? '<svg class="w-4 h-4 text-emerald-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>' : ''}
                </div>
            `).join('');
        }

        function saveData() { localStorage.setItem('habitOS_master', JSON.stringify(masterData)); }
        function deleteGoal(id) { if(confirm("Delete habit?")) { masterData[currentMonthName] = masterData[currentMonthName].filter(g => g.id !== id); saveData(); renderGrid(); updateGlobalAnalytics(); } }
        function factoryReset() { if(confirm("Erase all data?")) { localStorage.clear(); location.reload(); } }
        function exportData() {
            let csv = "Goal,Success Rate\n" + masterData[currentMonthName].map(g => `${g.name},${Math.round((g.checks.filter(c=>c===1).length/31)*100)}%`).join("\n");
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'report.csv'; a.click();
        }

        window.onload = init;
    </script>
</body>
</html>
